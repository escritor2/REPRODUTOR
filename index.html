<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Reprodutor de Mídia Offline Completo</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');

  :root {
    --color-bg: #ffffff;
    --color-bg-alt: #f9fafb;
    --color-primary: #111827;
    --color-primary-light: #374151;
    --color-text: #6b7280;
    --color-text-strong: #111827;
    --color-accent: #2563eb;
    --color-shadow: rgba(100, 116, 139, 0.1);
    --color-success: #10b981;
    --color-warning: #f59e0b;
    --radius: 0.75rem;
    --transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  *, *::before, *::after {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    background: var(--color-bg);
    color: var(--color-text);
    font-family: "Poppins", sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  header {
    position: sticky;
    top: 0;
    background: var(--color-bg);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1.5rem 1rem 1rem;
    box-shadow: 0 1px 4px var(--color-shadow);
    z-index: 10;
  }

  header h1 {
    font-weight: 700;
    font-size: 2.5rem;
    color: var(--color-primary);
    user-select: none;
    letter-spacing: -0.03em;
  }

  .nav-btns {
    position: absolute;
    right: 1rem;
    display: flex;
    gap: 0.5rem;
  }

  .nav-btn {
    display: inline-block;
    padding: 0.75rem 1.5rem;
    background: var(--color-success);
    color: white;
    font-weight: 600;
    font-size: 1rem;
    border-radius: var(--radius);
    text-decoration: none;
    box-shadow: 0 4px 6px -1px rgba(16, 185, 129, 0.3);
    transition: background-color var(--transition), box-shadow var(--transition);
  }

  .nav-btn:hover {
    background: #059669;
    box-shadow: 0 10px 15px -3px rgba(16, 185, 129, 0.4);
  }

  .nav-btn.audio-btn {
    background: var(--color-accent);
    box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.3);
  }

  .nav-btn.audio-btn:hover {
    background: #1e40af;
    box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.4);
  }

  main {
    flex: 1;
    max-width: 900px;
    margin: 1rem auto 2rem;
    width: 100%;
    padding: 0 1rem;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .input-container {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .file-input-label, .directory-input-label, .save-playlist-btn, .load-playlist-btn {
    display: inline-block;
    padding: 0.75rem 1.5rem;
    background: var(--color-accent);
    color: white;
    font-weight: 600;
    font-size: 1rem;
    border-radius: var(--radius);
    cursor: pointer;
    user-select: none;
    transition: background-color var(--transition);
    border: none;
  }

  .file-input-label:hover, .directory-input-label:hover, .save-playlist-btn:hover, .load-playlist-btn:hover {
    background: #1e40af;
  }

  input[type="file"] {
    display: none;
  }

  .media-type-selector {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .type-btn {
    padding: 0.5rem 1.5rem;
    background: var(--color-bg-alt);
    border: 2px solid var(--color-shadow);
    border-radius: var(--radius);
    cursor: pointer;
    transition: all var(--transition);
    font-weight: 600;
  }

  .type-btn.active {
    background: var(--color-accent);
    color: white;
    border-color: var(--color-accent);
  }

  .search-container {
    max-width: 600px;
    margin: 0 auto;
  }

  .search-input {
    width: 100%;
    padding: 0.5rem 1rem;
    font-size: 1rem;
    border-radius: var(--radius);
    border: 2px solid var(--color-shadow);
    outline: none;
  }

  .search-input:focus {
    border-color: var(--color-accent);
  }

  .status-info {
    text-align: center;
    font-size: 0.9rem;
    color: var(--color-text);
  }

  .playlist {
    background: var(--color-bg-alt);
    border-radius: var(--radius);
    box-shadow: 0 4px 16px var(--color-shadow);
    padding: 1.5rem;
    max-height: 360px;
    overflow-y: auto;
    display: grid;
    grid-template-columns: 1fr;
    gap: 0.6rem;
  }

  .media-item {
    padding: 0.6rem 1rem;
    border-radius: var(--radius);
    cursor: pointer;
    color: var(--color-text);
    font-weight: 600;
    font-size: 1rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    transition: all var(--transition);
    user-select: none;
  }

  .media-item:hover, .media-item:focus-visible {
    background: var(--color-accent);
    color: white;
    transform: scale(1.03);
  }

  .media-item.active {
    background: var(--color-primary);
    color: white;
  }

  .media-item.hidden {
    display: none;
  }

  .media-icon {
    flex-shrink: 0;
    width: 1.2rem;
    height: 1.2rem;
    fill: var(--color-primary-light);
  }

  .media-item.active .media-icon {
    fill: white;
  }

  .video-container {
    position: relative;
    width: 100%;
    max-width: 800px;
    margin: 0 auto;
    border-radius: var(--radius);
    overflow: hidden;
    box-shadow: 0 4px 16px var(--color-shadow);
    display: none;
  }

  .video-container.active {
    display: block;
  }

  video {
    width: 100%;
    height: auto;
    display: block;
  }

  .audio-container {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .audio-container.hidden {
    display: none;
  }

  .controls-container {
    background: var(--color-bg-alt);
    border-radius: var(--radius);
    box-shadow: 0 4px 16px var(--color-shadow);
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .player-controls {
    display: flex;
    justify-content: center;
    gap: 3rem;
    align-items: center;
  }

  button.control-btn {
    background: none;
    border: none;
    color: var(--color-primary-light);
    cursor: pointer;
    transition: color var(--transition), transform var(--transition);
    font-size: 2.4rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    padding: 0.2rem;
  }

  button.control-btn:hover, button.control-btn:focus-visible {
    color: var(--color-accent);
    transform: scale(1.14);
  }

  button.control-btn:disabled {
    color: var(--color-text);
    cursor: default;
    transform: none;
  }

  .player-info {
    text-align: center;
    font-weight: 600;
    font-size: 1.25rem;
    color: var(--color-text-strong);
    min-height: 1.5em;
  }

  .progress-container {
    width: 100%;
    max-width: 600px;
    margin: 0 auto;
  }

  .progress-bar {
    width: 100%;
    height: 8px;
    background: var(--color-shadow);
    border-radius: 4px;
    cursor: pointer;
    position: relative;
  }

  .progress-filled {
    height: 100%;
    background: var(--color-accent);
    width: 0%;
    border-radius: 4px 0 0 4px;
    transition: width 0.1s linear;
  }

  .time-display {
    display: flex;
    justify-content: space-between;
    font-size: 0.9rem;
    color: var(--color-text-strong);
    margin-top: 0.25rem;
    font-weight: 600;
  }

  .volume-container {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    max-width: 200px;
    margin: 0 auto;
  }

  .volume-slider {
    width: 100%;
  }

  .volume-icon {
    font-size: 1.5rem;
    cursor: pointer;
    user-select: none;
  }

  .shuffle-repeat-container {
    display: flex;
    justify-content: center;
    gap: 2rem;
  }

  .toggle-btn {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 1.8rem;
    color: var(--color-primary-light);
    transition: color var(--transition);
  }

  .toggle-btn.active {
    color: var(--color-accent);
  }

  .video-controls {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(transparent, rgba(0,0,0,0.7));
    padding: 1rem;
    opacity: 0;
    transition: opacity var(--transition);
  }

  .video-container:hover .video-controls {
    opacity: 1;
  }

  .video-controls button {
    background: none;
    border: none;
    color: white;
    font-size: 1.5rem;
    cursor: pointer;
    margin: 0 0.5rem;
  }

  .fullscreen-btn {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: rgba(0,0,0,0.5);
    color: white;
    border: none;
    padding: 0.5rem;
    border-radius: var(--radius);
    cursor: pointer;
    font-size: 1.2rem;
  }

  @media (max-width: 600px) {
    header h1 {
      font-size: 2rem;
    }

    .nav-btns {
      position: static;
      justify-content: center;
      margin-top: 1rem;
    }

    .nav-btn {
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
    }

    main {
      padding: 0 1rem;
    }

    .player-controls {
      flex-direction: column;
      gap: 1rem;
    }

    button.control-btn {
      font-size: 2rem;
      padding: 0.5rem;
    }
  }
</style>
</head>
<body>
<header>
  <h1>Reprodutor de Mídia Offline</h1>
  <div class="nav-btns">
    <a href="#" class="nav-btn audio-btn" id="audio-view-btn">Modo Áudio</a>
    <a href="#" class="nav-btn" id="video-view-btn">Modo Vídeo</a>
  </div>
</header>

<main>
  <div class="input-container">
    <label class="file-input-label" for="file-input" tabindex="0">
      Adicionar Mídias
    </label>
    <input type="file" id="file-input" multiple accept="audio/*,video/*" />
    
    <label class="directory-input-label" for="directory-input" tabindex="0">
      Adicionar Pasta
    </label>
    <input type="file" id="directory-input" webkitdirectory accept="audio/*,video/*" />
  </div>

  <div class="media-type-selector">
    <button class="type-btn active" data-type="all">Todos</button>
    <button class="type-btn" data-type="audio">Áudio</button>
    <button class="type-btn" data-type="video">Vídeo</button>
  </div>

  <div class="search-container">
    <input type="text" id="search-input" class="search-input" placeholder="Buscar mídias..." />
  </div>

  <div class="status-info" id="status-info">0 mídias carregadas</div>
  
  <section class="playlist" id="playlist"></section>

  <div class="video-container" id="video-container">
    <video id="video" preload="metadata">
      Seu navegador não suporta vídeo.
    </video>
    <button class="fullscreen-btn" id="fullscreen-btn" title="Tela cheia">⛶</button>
    <div class="video-controls">
      <button id="video-play-pause">▶</button>
      <button id="video-prev">⏮</button>
      <button id="video-next">⏭</button>
      <input type="range" id="video-volume" min="0" max="1" step="0.1" value="1">
    </div>
  </div>

  <div class="audio-container" id="audio-container">
    <div class="controls-container">
      <div class="shuffle-repeat-container">
        <button id="shuffle-btn" class="toggle-btn" title="Aleatório">🔀</button>
        <button id="repeat-btn" class="toggle-btn" title="Repetir">🔁</button>
      </div>

      <div class="progress-container">
        <div class="progress-bar" id="progress-bar">
          <div class="progress-filled" id="progress-filled"></div>
        </div>
        <div class="time-display">
          <span id="current-time">0:00</span>
          <span id="duration">0:00</span>
        </div>
      </div>

      <div class="volume-container">
        <span id="volume-icon" class="volume-icon">🔊</span>
        <input type="range" id="volume-slider" class="volume-slider" min="0" max="1" step="0.01" value="1">
      </div>

      <div class="player-controls">
        <button class="control-btn" id="prev-btn" disabled>⏮</button>
        <button class="control-btn" id="play-pause-btn" disabled>▶</button>
        <button class="control-btn" id="next-btn" disabled>⏭</button>
      </div>
      
      <div class="player-info" id="player-info">Nenhuma mídia selecionada</div>
    </div>
  </div>

  <audio id="audio" preload="metadata"></audio>
</main>

<script>
(() => {
  'use strict';

  // Elementos do DOM
  const fileInput = document.getElementById('file-input');
  const directoryInput = document.getElementById('directory-input');
  const playlistEl = document.getElementById('playlist');
  const audio = document.getElementById('audio');
  const video = document.getElementById('video');
  const videoContainer = document.getElementById('video-container');
  const audioContainer = document.getElementById('audio-container');
  const playPauseBtn = document.getElementById('play-pause-btn');
  const videoPlayPauseBtn = document.getElementById('video-play-pause');
  const prevBtn = document.getElementById('prev-btn');
  const videoPrevBtn = document.getElementById('video-prev');
  const nextBtn = document.getElementById('next-btn');
  const videoNextBtn = document.getElementById('video-next');
  const playerInfo = document.getElementById('player-info');
  const statusInfo = document.getElementById('status-info');
  const progressBar = document.getElementById('progress-bar');
  const progressFilled = document.getElementById('progress-filled');
  const currentTimeEl = document.getElementById('current-time');
  const durationEl = document.getElementById('duration');
  const volumeSlider = document.getElementById('volume-slider');
  const videoVolumeSlider = document.getElementById('video-volume');
  const volumeIcon = document.getElementById('volume-icon');
  const shuffleBtn = document.getElementById('shuffle-btn');
  const repeatBtn = document.getElementById('repeat-btn');
  const searchInput = document.getElementById('search-input');
  const fullscreenBtn = document.getElementById('fullscreen-btn');
  const typeBtns = document.querySelectorAll('.type-btn');
  const audioViewBtn = document.getElementById('audio-view-btn');
  const videoViewBtn = document.getElementById('video-view-btn');

  // Variáveis de estado
  let mediaFiles = [];
  let currentIndex = -1;
  let isPlaying = false;
  let isShuffle = false;
  let isRepeat = false;
  let shuffledOrder = [];
  let currentType = 'all';
  let isMuted = false;
  let lastVolume = 1;

  // Extensões de arquivo suportadas
  const audioExtensions = ['mp3', 'wav', 'ogg', 'flac', 'aac', 'm4a', 'wma'];
  const videoExtensions = ['mp4', 'webm', 'ogg', 'avi', 'mov', 'mkv', 'flv', 'wmv'];

  // Determina o tipo de arquivo
  function getFileType(filename) {
    const extension = filename.split('.').pop().toLowerCase();
    if (audioExtensions.includes(extension)) return 'audio';
    if (videoExtensions.includes(extension)) return 'video';
    return 'unknown';
  }

  // Cria elemento de mídia para a playlist
  function createMediaElement(file, index) {
    const mediaEl = document.createElement('div');
    mediaEl.className = 'media-item';
    mediaEl.setAttribute('role', 'listitem');
    mediaEl.tabIndex = 0;
    mediaEl.dataset.index = index;
    mediaEl.dataset.type = getFileType(file.name);

    const iconSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    iconSvg.setAttribute('viewBox', '0 0 24 24');
    iconSvg.classList.add('media-icon');
    
    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    const fileType = getFileType(file.name);
    
    if (fileType === 'audio') {
      path.setAttribute('d', 'M12 3v10.55A4 4 0 1 0 14 17V7h4V3h-6z');
    } else if (fileType === 'video') {
      path.setAttribute('d', 'M18 4l2 4h-3l-2-4h-2l2 4h-3l-2-4H8l2 4H7L5 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.89 2 2 2h16c1.1 0 2-.9 2-2V4h-4z');
    }
    
    iconSvg.appendChild(path);
    mediaEl.appendChild(iconSvg);

    const fileName = document.createElement('span');
    fileName.textContent = file.name.replace(/\.[^/.]+$/, "");
    mediaEl.appendChild(fileName);

    mediaEl.addEventListener('click', () => {
      loadMedia(index);
      playMedia();
    });

    return mediaEl;
  }

  // Renderiza a playlist
  function renderPlaylist() {
    playlistEl.innerHTML = '';
    const filteredFiles = currentType === 'all' 
      ? mediaFiles 
      : mediaFiles.filter(file => getFileType(file.name) === currentType);

    filteredFiles.forEach((file, idx) => {
      const originalIndex = mediaFiles.indexOf(file);
      const mediaEl = createMediaElement(file, originalIndex);
      
      if (originalIndex === currentIndex) {
        mediaEl.classList.add('active');
      }
      
      mediaEl.classList.remove('hidden');
      playlistEl.appendChild(mediaEl);
    });
    
    updateStatusInfo();
  }

  // Carrega a mídia para reprodução
  function loadMedia(index) {
    if (index < 0 || index >= mediaFiles.length) return;
    currentIndex = index;
    const file = mediaFiles[index];
    const fileURL = URL.createObjectURL(file);
    const fileType = getFileType(file.name);

    if (fileType === 'audio') {
      showAudioPlayer();
      audio.src = fileURL;
      video.pause();
    } else if (fileType === 'video') {
      showVideoPlayer();
      video.src = fileURL;
      audio.pause();
    }

    updateActiveMedia();
    updatePlayerInfo(`Selecionado: ${file.name.replace(/\.[^/.]+$/, "")}`);
    updateControls();
  }

  // Mostra o player de áudio
  function showAudioPlayer() {
    videoContainer.classList.remove('active');
    audioContainer.classList.remove('hidden');
  }

  // Mostra o player de vídeo
  function showVideoPlayer() {
    videoContainer.classList.add('active');
    audioContainer.classList.add('hidden');
  }

  // Atualiza o item ativo na playlist
  function updateActiveMedia() {
    const mediaElements = playlistEl.querySelectorAll('.media-item');
    mediaElements.forEach((el) => {
      const index = parseInt(el.dataset.index);
      el.classList.toggle('active', index === currentIndex);
    });
  }

  // Inicia a reprodução
  function playMedia() {
    if (currentIndex === -1) return;
    
    const fileType = getFileType(mediaFiles[currentIndex].name);
    
    if (fileType === 'audio') {
      audio.play()
        .then(() => {
          isPlaying = true;
          playPauseBtn.innerHTML = '⏸';
          videoPlayPauseBtn.innerHTML = '⏸';
          updatePlayerInfo(`Tocando: ${mediaFiles[currentIndex].name.replace(/\.[^/.]+$/, "")}`);
        })
        .catch(error => {
          console.error("Erro ao reproduzir:", error);
        });
    } else if (fileType === 'video') {
      video.play()
        .then(() => {
          isPlaying = true;
          playPauseBtn.innerHTML = '⏸';
          videoPlayPauseBtn.innerHTML = '⏸';
          updatePlayerInfo(`Reproduzindo: ${mediaFiles[currentIndex].name.replace(/\.[^/.]+$/, "")}`);
        })
        .catch(error => {
          console.error("Erro ao reproduzir:", error);
        });
    }
    
    updateControls();
  }

  // Pausa a reprodução
  function pauseMedia() {
    isPlaying = false;
    audio.pause();
    video.pause();
    playPauseBtn.innerHTML = '▶';
    videoPlayPauseBtn.innerHTML = '▶';
    updatePlayerInfo(`Pausado: ${mediaFiles[currentIndex].name.replace(/\.[^/.]+$/, "")}`);
    updateControls();
  }

  // Atualiza os controles
  function updateControls() {
    prevBtn.disabled = currentIndex <= 0 && !isShuffle;
    nextBtn.disabled = currentIndex >= mediaFiles.length - 1 && !isShuffle;
    shuffleBtn.classList.toggle('active', isShuffle);
    repeatBtn.classList.toggle('active', isRepeat);
  }

  // Atualiza as informações de status
  function updateStatusInfo() {
    const audioCount = mediaFiles.filter(f => getFileType(f.name) === 'audio').length;
    const videoCount = mediaFiles.filter(f => getFileType(f.name) === 'video').length;
    
    if (currentType === 'all') {
      statusInfo.textContent = `${mediaFiles.length} mídias (${audioCount} áudios, ${videoCount} vídeos)`;
    } else if (currentType === 'audio') {
      statusInfo.textContent = `${audioCount} músicas`;
    } else {
      statusInfo.textContent = `${videoCount} vídeos`;
    }
  }

  // Alterna entre play/pause
  function playPauseToggle() {
    if (isPlaying) {
      pauseMedia();
    } else {
      playMedia();
    }
  }

  // Reproduz o próximo item
  function playNext() {
    if (isShuffle) {
      if (shuffledOrder.length === 0) {
        shuffledOrder = [...Array(mediaFiles.length).keys()];
        shuffleArray(shuffledOrder);
      }
      const nextIndex = shuffledOrder.shift();
      loadMedia(nextIndex);
      playMedia();
    } else if (currentIndex < mediaFiles.length - 1) {
      loadMedia(currentIndex + 1);
      playMedia();
    } else if (isRepeat) {
      loadMedia(currentIndex);
      playMedia();
    } else if (mediaFiles.length > 0) {
      loadMedia(0);
      playMedia();
    }
  }

  // Reproduz o item anterior
  function playPrev() {
    if (currentIndex > 0) {
      loadMedia(currentIndex - 1);
      playMedia();
    }
  }

  // Atualiza as informações do player
  function updatePlayerInfo(text) {
    playerInfo.textContent = text;
  }

  // Processa os arquivos selecionados
  function handleFiles(files) {
    const newFiles = Array.from(files);
    if (newFiles.length === 0) {
      alert("Nenhum arquivo encontrado.");
      return;
    }
    
    const validFiles = newFiles.filter(file => {
      const type = getFileType(file.name);
      return type === 'audio' || type === 'video';
    });
    
    if (validFiles.length === 0) {
      alert("Nenhum arquivo de mídia válido encontrado.");
      return;
    }
    
    mediaFiles = mediaFiles.concat(validFiles);
    renderPlaylist();
    
    if (currentIndex === -1 && mediaFiles.length > 0) {
      loadMedia(0);
    } else {
      updateControls();
    }
  }

  // Formata o tempo (mm:ss)
  function formatTime(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
  }

  // Embaralha um array
  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }

  // Event listeners
  fileInput.addEventListener('change', () => {
    handleFiles(fileInput.files);
    fileInput.value = '';
  });

  directoryInput.addEventListener('change', () => {
    handleFiles(directoryInput.files);
    directoryInput.value = '';
  });

  playPauseBtn.addEventListener('click', playPauseToggle);
  videoPlayPauseBtn.addEventListener('click', playPauseToggle);
  prevBtn.addEventListener('click', playPrev);
  videoPrevBtn.addEventListener('click', playPrev);
  nextBtn.addEventListener('click', playNext);
  videoNextBtn.addEventListener('click', playNext);

  shuffleBtn.addEventListener('click', () => {
    isShuffle = !isShuffle;
    if (isShuffle) {
      shuffledOrder = [...Array(mediaFiles.length).keys()];
      shuffleArray(shuffledOrder);
    }
    updateControls();
  });

  repeatBtn.addEventListener('click', () => {
    isRepeat = !isRepeat;
    updateControls();
  });

  // Atualiza a barra de progresso
  function updateProgress() {
    const currentMedia = getFileType(mediaFiles[currentIndex]?.name) === 'video' ? video : audio;
    if (currentMedia && currentMedia.duration) {
      const percent = (currentMedia.currentTime / currentMedia.duration) * 100;
      progressFilled.style.width = percent + '%';
      currentTimeEl.textContent = formatTime(currentMedia.currentTime);
      durationEl.textContent = formatTime(currentMedia.duration);
    }
  }

  audio.addEventListener('timeupdate', updateProgress);
  video.addEventListener('timeupdate', updateProgress);

  progressBar.addEventListener('click', (e) => {
    const currentMedia = getFileType(mediaFiles[currentIndex]?.name) === 'video' ? video : audio;
    if (currentMedia && currentMedia.duration) {
      const rect = progressBar.getBoundingClientRect();
      const percent = (e.clientX - rect.left) / rect.width;
      currentMedia.currentTime = percent * currentMedia.duration;
    }
  });

  // Controle de volume
  function updateVolume() {
    const volume = volumeSlider.value;
    audio.volume = volume;
    video.volume = volume;
    
    if (volume === 0) {
      volumeIcon.textContent = '🔇';
      isMuted = true;
    } else {
      volumeIcon.textContent = '🔊';
      isMuted = false;
      lastVolume = volume;
    }
  }

  volumeSlider.addEventListener('input', updateVolume);
  videoVolumeSlider.addEventListener('input', updateVolume);

  volumeIcon.addEventListener('click', () => {
    if (isMuted) {
      volumeSlider.value = lastVolume;
      videoVolumeSlider.value = lastVolume;
      updateVolume();
    } else {
      lastVolume = volumeSlider.value;
      volumeSlider.value = 0;
      videoVolumeSlider.value = 0;
      updateVolume();
    }
  });

  // Busca
  searchInput.addEventListener('input', () => {
    const query = searchInput.value.toLowerCase();
    const mediaElements = playlistEl.querySelectorAll('.media-item');
    mediaElements.forEach(el => {
      const text = el.textContent.toLowerCase();
      el.classList.toggle('hidden', !text.includes(query));
    });
  });

  // Filtro por tipo de mídia
  typeBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      typeBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentType = btn.dataset.type;
      renderPlaylist();
    });
  });

  // Reprodução automática do próximo item
  audio.addEventListener('ended', () => {
    if (!isRepeat) playNext();
  });

  video.addEventListener('ended', () => {
    if (!isRepeat) playNext();
  });

  // Tela cheia
  fullscreenBtn.addEventListener('click', () => {
    if (video.requestFullscreen) {
      video.requestFullscreen();
    } else if (video.webkitRequestFullscreen) {
      video.webkitRequestFullscreen();
    } else if (video.msRequestFullscreen) {
      video.msRequestFullscreen();
    }
  });

  // Atalhos de teclado
  document.addEventListener('keydown', (e) => {
    if (e.target.tagName === 'INPUT') return;
    
    switch(e.key) {
      case ' ':
        if (currentIndex !== -1) {
          e.preventDefault();
          playPauseToggle();
        }
        break;
      case 'ArrowRight':
        if (currentIndex !== -1) {
          e.preventDefault();
          playNext();
        }
        break;
      case 'ArrowLeft':
        if (currentIndex !== -1) {
          e.preventDefault();
          playPrev();
        }
        break;
    }
  });

  // Botões de visualização (áudio/vídeo)
  audioViewBtn.addEventListener('click', (e) => {
    e.preventDefault();
    currentType = 'audio';
    typeBtns.forEach(btn => {
      btn.classList.toggle('active', btn.dataset.type === 'audio');
    });
    renderPlaylist();
    if (currentIndex !== -1 && getFileType(mediaFiles[currentIndex].name) === 'audio') {
      showAudioPlayer();
    }
  });

  videoViewBtn.addEventListener('click', (e) => {
    e.preventDefault();
    currentType = 'video';
    typeBtns.forEach(btn => {
      btn.classList.toggle('active', btn.dataset.type === 'video');
    });
    renderPlaylist();
    if (currentIndex !== -1 && getFileType(mediaFiles[currentIndex].name) === 'video') {
      showVideoPlayer();
    }
  });

  // Service Worker para funcionar offline
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('sw.js').then(registration => {
        console.log('ServiceWorker registrado com sucesso: ', registration.scope);
      }).catch(error => {
        console.log('Falha ao registrar ServiceWorker: ', error);
      });
    });
  }
})();
</script>
</body>
</html>
